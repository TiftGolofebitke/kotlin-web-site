<!DOCTYPE html>
    <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<html>
    <head>
        <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">


<link rel="Shortcut Icon" href="/assets/images/favicon.ico" type="image/x-icon"/>
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png" />
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/syntax.css">
<link rel="stylesheet" href="/css/keywords.css">


<title>Null Safety</title>

    </head>
    <body>
    <section>
        <div class="container">
            <div class="grid">
                <div class="row">
                    <div class="col-2">
                        <h1>Null Safety</h1>
                        <!--<ul class="navigation">
                            <li><a href="">Docs Home</a></li>
                            <li><a href="">Examples</a></li>
                            <li><a href="">Comparison to Java</a></li>
                            <li><a href="">Comparison to Scala</a></li>
                            <li><a href="">Modules and Compilation</a></li>
                            <li><a href="">Packages</a></li>
                            <li><a href="">Functions</a></li>
                            <li><a href="">Properties And Fields</a></li>
                        </ul>-->
                        <div id="toc"></div>
                    </div>
                    <div class="col-4">
                            <p>Kotlin’s type system is aimed at eliminating null references from code, also known as the <a href="http://qconlondon.com/london-2009/presentation/Null+References:+The+Billion+Dollar+Mistake">The Billion Dollar Mistake</a></p>

<p>One of the most common pitfalls in many programming languages, including Java is that of accessing a member of a null references, resulting in null reference exceptions. In Java this
would be the equivalent of a <em class="keyword">NullPointerException</em> or NPE for short.</p>

<h2 id="nullable-types-and-non-null-types">Nullable types and Non-Null Types</h2>

<p>Kotlin’s type system is aimed to eliminate NullPointerException’s from our code. The only possible causes of NPE’s may be</p>

<ul>
  <li>An explicit call to throw NullPointerException()</li>
  <li>External Java Code has caused it</li>
  <li>There’s some data inconsistency with regard to initialization (an uninitialized <em>this</em> available in a constructor is used somewhere)</li>
</ul>

<p>In Kotlin the type system distinguishes between references that can hold null (nullable references) and those that can not (non-null references).
For example, a regular variable of type String can not hold null:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">var</span> <span class="n">a</span> <span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="s">&quot;abc&quot;</span>
<span class="n">a</span> <span class="p">=</span> <span class="p">*</span><span class="k">null</span><span class="p">*{:</span> <span class="p">.</span><span class="n">error</span> <span class="p">}</span> <span class="c1">// compilation error</span>
</code></pre></div>

<p>To allow nulls, we can declare a variable as nullable string, written String?:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">var</span> <span class="n">b</span> <span class="p">:</span> <span class="n">String</span><span class="p">?</span> <span class="p">=</span> <span class="s">&quot;abc&quot;</span>
<span class="n">b</span> <span class="p">=</span> <span class="k">null</span> <span class="c1">// ok</span>
</code></pre></div>

<p>Now, if you call a method on a, it’s guaranteed not to cause an NPE, so you can safely say</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">=</span> <span class="n">a</span><span class="p">.</span><span class="n">length</span><span class="p">()</span>
</code></pre></div>

<p>But if you want to call the same method on b, that would not be safe, and the compiler reports an error:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">=</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="c1">// error: variable &#39;b&#39; can be null</span>
</code></pre></div>

<p>But we still need to call that method, right? There are a few ways of doing that.</p>

<h2 id="checking-for-null-in-conditions">Checking for null in conditions</h2>

<p>First, you can explicitly check if b is null, and handle the two options separately:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="k">else</span> <span class="p">-</span><span class="m">1</span>
</code></pre></div>

<p>The compiler tracks the information about the check you performed, and allows the call to length() inside the if. More complex conditions are supported as well:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
  <span class="n">print</span><span class="p">(</span><span class="s">&quot;String of length ${b.length()}&quot;</span><span class="p">)</span>
<span class="k">else</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">&quot;Empty string&quot;</span><span class="p">)</span>
</code></pre></div>

<p>Note that this only works where b is immutable (i.e. a local <em class="keyword">val</em> or a member <em class="keyword">val</em> which has a backing field and is not overridable), because otherwise it might happen that b changes to null after the check.</p>

<h2 id="safe-calls">Safe Calls</h2>

<p>Your second option is the safe call operator, written ?.:</p>

<div class="highlight"><pre><code class="kotlin"><span class="n">b</span><span class="p">?.</span><span class="n">length</span><span class="p">()</span>
</code></pre></div>

<p>This returns b.length() if b is not null, and null otherwise. The type of this expression is Int?.</p>

<p>Safe calls are useful in chains. For example, if Bob, an Employee, may be assigned to a Department (or not), that in turn may have another Employee as a department head, then to obtain the name of Bob’s department head, if any), we write the following:</p>

<div class="highlight"><pre><code class="kotlin"><span class="n">bob</span><span class="p">?.</span><span class="n">department</span><span class="p">?.</span><span class="n">head</span><span class="p">?.</span><span class="n">name</span>
</code></pre></div>

<p>Such a chain returns null if any of the properties in it is null.</p>

<h2 id="elvis-operator">Elvis Operator</h2>

<p>When we have a nullable reference r, we can say “if r is not null, use it, otherwise use some non-null value x”:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">:</span> <span class="n">Int</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="n">b</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="k">else</span> <span class="p">-</span><span class="m">1</span>
</code></pre></div>

<p>Along with the complete if expression, this can be expressed with the Elvis operator, written ?::</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">=</span> <span class="n">b</span><span class="p">?.</span><span class="n">length</span><span class="p">()</span> <span class="p">?:</span> <span class="p">-</span><span class="m">1</span>
</code></pre></div>

<p>If the expression to the left of ?: is not null, the elvis operator returns it, otherwise it returns the expression to the right. Note that the right-hand side expression is evaluated only if the left-hand side is null.</p>

<h2 id="the--operator">The !! Operator</h2>

<p>The third option is for NPE-lovers. One can write b!!, and this will return a non-null value of b (e.g., a String in our example) or throw an NPE if b is null:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">l</span> <span class="p">=</span> <span class="n">b</span><span class="p">!!.</span><span class="n">length</span><span class="p">()</span>
</code></pre></div>

<p>Thus, if you want an NPE, you can have it, but you have to ask for it explicitly, and it does not appear out of the blue.</p>

<p>By the way, !! is added for conciseness, and formerly was emulated by an extension function from the standard library, defined as follows:</p>

<div class="highlight"><pre><code class="kotlin"><span class="n">inline</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span> <span class="p">:</span> <span class="n">Any</span><span class="p">&gt;</span> <span class="n">T</span><span class="p">?.</span><span class="n">sure</span><span class="p">()</span> <span class="p">:</span> <span class="n">T</span> <span class="p">=</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="k">throw</span> <span class="nf">NullPointerException</span><span class="p">()</span>
  <span class="k">else</span>
    <span class="k">this</span>
</code></pre></div>

<h2 id="safe-casts">Safe Casts</h2>

<p>Regular casts may result into a ClassCastException if the object is not of the target type. Another option is to use safe casts that return null is the attempt was not successful:</p>

<div class="highlight"><pre><code class="kotlin"><span class="k">val</span> <span class="n">aInt</span> <span class="p">:</span> <span class="n">Int</span><span class="p">?</span> <span class="p">=</span> <span class="n">a</span> <span class="k">as</span><span class="p">?</span> <span class="n">Int</span>
</code></pre></div>


                    </div>
                </div>
            </div>

        </div>
        <div id="related">
            <h4>Related</h4>


            

        </div>

        <!--
Footer details such as copyright notice, etc.
-->

        <!--
Include all scripts required here
-->

<script type="text/javascript" src="/scripts/jquery-2.0.3.min.js"></script>
<script type="text/javascript" src="/scripts/jquery.toc.min.js"></script>


        
    </section>
    </body>
</html>
